{% extends 'base.html' %}
{% load static %}
{% load django_bootstrap5 %}
{% bootstrap_css %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
<link rel="icon" href="https://templates.pingendo.com/assets/Pingendo_favicon.ico">

{% block content %}
<div class='wraper m-auto' style='max-width:720px; width:auto; box-shadow:0 0 20px rgb(0 0 0 / 5%);'>
<div class='container py-3' style='background-color:rgb(252, 248, 237, 0.7);'>
<div>
{% comment %} ë¹µì§‘ ì´ë¦„ {% endcomment %}
<h3 class='fw-bolder'><a href="{% url 'bakeries:shop_home' review.shop_id %}" style='text-decoration:none; color:black'>ğŸ{{ review.shop_name }}</a></h3>
</div>
<div class='header d-flex'>
  <div class='profile d-flex mt-2'>
  
  {% comment %} ë¦¬ë·° ì‘ì„±ì í”„ë¡œí•„ ì‚¬ì§„ {% endcomment %}
  <span class='profile-pic' style="background-image">
    
  </span>
  {% comment %} ë¦¬ë·° ì‘ì„±ì ì´ë¦„(í´ë¦­í•˜ë©´ ë¦¬ë·° í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™) {% endcomment %}
  <span class='username'><a class='text-decoration-none fw-bolder' style='color:black' href="{% url 'accounts:detail' review.user.pk %}"><img src="{{ review.user.profile_set.all.0.image.url }}" style='width:25px; height:25px; border-radius:50%'>&nbsp;&nbsp;{{ review.user.username }}</a></span>
  {% comment %} ë¦¬ë·° ì‘ì„± ê°œìˆ˜ {% endcomment %}
  <span>&nbsp;ë¦¬ë·° {{ user.review_set.count }}ê°œ</span>
  </div>
  
  {% comment %} íŒ”ë¡œìš° ë²„íŠ¼ {% endcomment %}
  {% if request.user != review.user %}
    <div style='margin-left:auto; margin-right:1rem'>
      {% comment %} ë¦¬ë·°ë¥¼ ì‘ì„±í•œ userì˜ pkê°’ì´ í•„ìš”í•˜ë¯€ë¡œ data-user-idë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•´ì•¼ í•¨! {% endcomment %}
      <form id='follow-form' data-user-id='{{ review.user.pk }}'>
        {% csrf_token %}
        {% if request.user in user.followers.all %}
          <input id='follow-btn' type="submit" class="btn btn-warning btn-rounded follow-btn fw-bolder" style='border-radius:20px; margin-left:auto' value='ì–¸íŒ”ë¡œìš°'>
        {% else %}
          <input id='follow-btn' type="submit" class="btn btn-warning btn-rounded follow-btn fw-bolder" style='border-radius:20px; margin-left:auto' value='íŒ”ë¡œìš°'>
        {% endif %}
      </form>
    </div>
  {% endif %}
  </div>
</div>

{% comment %} <div>
  <button class='btn btn-warning btn-rounded' style='border-radius:20px; margin-left:auto'>
  <span class='label fw-bolder'>íŒ”ë¡œìš°</span>
  </button>
</div> {% endcomment %}

{% comment %} ìµœê·¼ ë°©ë¬¸ì¼ {% endcomment %}
<p class='mt-3 fw-bolder'>{{ review.visited_at.isoformat }}</p>
{% comment %} ë¦¬ë·° ì´ë¯¸ì§€ {% endcomment %}
{% if review.image %}
<div style='text-align:center'>
  <img src='{{ review.image.url }}' alt='{{ review.image }}' width="400" height="300" style='border-radius:4px;'>
</div>
{% endif %} 
{% comment %} endif ìœ„ì¹˜ê°€ ì´ë¯¸ì§€ë¥¼ ê°ì‹¸ëŠ” div ì•„ë˜ì— ìˆì–´ì•¼ í•¨ {% endcomment %}
  <p class="me-3-5 mt-3">{{ review.content }}</p>
<span>
{% comment %} ì¢‹ì•„ìš” ë²„íŠ¼ {% endcomment %}
    {% if request.user.is_authenticated %}
      <form data-review-id='{{ review.pk }}' id='like-btn' class="like-heart">
        {% csrf_token %}
        <button style='background-color:transparent; border:none;' class='review-detail-like-btn' type='submit'>
          {% if request.user in review.like_users.all %}
            <i style='color:red' class="bi bi-heart-fill"></i>
            <span id='review-like-user-cnt'>{{ review.like_users.count }}</span>
          {% else %}
            <i style='color:red' class="bi bi-heart"></i>
            <span id='review-like-user-cnt'>{{ review.like_users.count }}</span>
          {% endif %}
        </button>
      </form>
</span>
    {% endif %}

{% if request.user == review.user %}
<div class='mt-2 d-flex'>
{% comment %} ìš”ì²­í•œ userê°€ ë¦¬ë·°ë¥¼ ì‘ì„±í•œ userì¼ ê²½ìš°ì— ìˆ˜ì • ë° ì‚­ì œ{% endcomment %}
  <p>
    <button type="button" class="btn btn-warning me-2" >
      <a href="{% url 'reviews:update' review.pk %}" style='text-decoration:none; color:white' class='fw-bolder'>ìˆ˜ì •í•˜ê¸°</a>
    </button>
  </p>
  <p>
    <form action="{% url 'reviews:delete' review.pk %}" method="POST">
      {% csrf_token %}
      <input type="submit" class="btn btn-danger fw-bolder" value="ì‚­ì œí•˜ê¸°">
    </form>
  </p>
</div>
{% endif %}

{% comment %} ëŒ“ê¸€ {% endcomment %}
<h4 class="my-3 fw-bolder">ëŒ“ê¸€</h4>
{% if request.user.is_authenticated %}
<form action="{% url 'reviews:comment_create' review.pk %}" method="POST">
  {% csrf_token %}
  {% bootstrap_form comment_form layout='inline'%}
  {% bootstrap_button style='float:right; color:white' button_type="submit" button_class="btn btn-warning fw-bolder mt-1" content="OK" %}
</form>
{% endif %}

{% for comment in comments %}
<div class='py-3 mt-'>
  <div class="align-items-center">
    <a class="text-decoration-none fw-bolder" style='color:gray' href="{% url 'accounts:detail' comment.user.pk %}">{{ comment.user.username }}</a>&nbsp;&nbsp;{{ comment.content }}
  </div>
  {% comment %} ëŒ“ê¸€ì„ ì‘ì„±í•œ userê°€ ë¦¬ë·°ë¥¼ ì“´ ìœ ì €ì¸ ê²½ìš° {% endcomment %}
  {% if review.user == comment.user %} 
    <form action="{% url 'reviews:comment_delete' review.pk comment.pk %}" method="POST" class="my-0">
      {% csrf_token %}
      <input type="submit" class="btn btn-outline-danger mt-2" value="ì‚­ì œ">
    </form>
  {% endif %}
{% empty %}
  <br>  
{% endfor %}
</div>
</div>
</div>  
{% endblock %}

{% block js %}
{% comment %} ë¦¬ë·° ì¢‹ì•„ìš” ë¹„ë™ê¸° ìë°”ìŠ¤í¬ë¦½íŠ¸ {% endcomment %}
<script src="{% static 'js/reviews/review_like.js' %}"></script>
{% comment %} íŒ”ë¡œìš° ë¹„ë™ê¸° ìë°”ìŠ¤í¬ë¦½íŠ¸ {% endcomment %}
<script src="{% static 'js/reviews/follow.js' %}"></script>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
{% endblock js %}